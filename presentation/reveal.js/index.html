<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>reveal.js</title>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/black.css">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css">
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section>
            <p class="r-fit-text">ROBOTER</p>
            <h2 class="r-fit-text">Von Benjamin und Gustav</h2>
        </section>
        <!--
        Inhaltsverzeichnis:
        Roboter vorführen
        Roboter-Hardware
        Roboter:
            Initialisieren
            Kalibrieren
        Main-Methode
        Tanzen:
            Struktur erklären: Tanz in Einzelschritte aufgebaut
                Interface erklären
            Einzelne Tanzschritte
                Speed und RotateAmount
            [Geschwindigkeitssynchronisierung]
        Ende
        -->
        <section>
            <h2>Inhaltsverzeichnis</h2>
            <ol>
                <li>Demonstration</li>
                <li>Hardware</li>
                <li>Software</li>
            </ol>
        </section>
        <section>
            <h2>Hardware</h2>
            <ul>
                <li>3 Motoren: Linkes Bein, rechtes Bein, Arme</li>
                <li>2 Sensoren an den Beinen</li>
            </ul>
            <img src=""> <!-- TODO Hier ein Bild vom Roboter -->
        </section>
        <section data-auto-animate>
            <h1>Software</h1>
            <h2 class="r-fit-text">Roboter</h2>
        </section>
        <section data-auto-animate>
            <h2>Roboter</h2>
            <pre><code data-trim data-line-numbers>
                public class Main {
                    public static void main(String[] args) {
                        Robot robot = new Robot();
                    }
                }
            </code></pre>
        </section>
        <section>
            <section data-auto-animate>
                <h2>Roboter</h2>
                <!-- Falls noch Sachen wie Espeak wegfallen, hier auch ändern! -->
                <pre><code data-id="code" data-trim data-line-numbers="2-10|13-15|17-29|22-23">
                public class Robot {
                    private RegulatedMotor leftMotor;
                    private RegulatedMotor rightMotor;
                    private RegulatedMotor armsMotor;
                    private Touch leftSensor;
                    private Touch rightSensor;
                    private GraphicsLCD lcd;
                    private Sound sound;
                    private Buttons buttons;
                    private Espeak espeak;
                    /* ... */

                    Robot() {
                        init();
                    }

                    private void init() {
                        leftMotor = new NXTRegulatedMotor(MotorPort.C);
                        rightMotor = new NXTRegulatedMotor(MotorPort.B);
                        armsMotor = new NXTRegulatedMotor(MotorPort.A);

                        leftSensor = new EV3TouchSensor(SensorPort.S2);
                        rightSensor = new EV3TouchSensor(SensorPort.S1);

                        lcd = LCD.getInstance();
                        sound = Sound.getInstance();
                        espeak = new Espeak();
                        buttons = new Buttons();
                    }
                    /* ... */
                }
                </code></pre>
                <aside class="notes">
                    Variablen - Konstruktor - Init <br/>
                    Problem: Sensor
                </aside>
            </section>
            <section data-auto-animate>
                <h2>Roboter</h2>
                <pre><code data-id="code" data-trim data-line-numbers="6-9|10-11"
                           data-ln-start-from="22">
                    /* ... */
                    try {
                        leftSensor = new EV3TouchSensor(SensorPort.S2);
                        rightSensor = new EV3TouchSensor(SensorPort.S1);
                    } catch (RuntimeException e) {
                        Sysfs.writeString("/sys/class/lego-port/port0/set_device",
                    "lego-nxt-touch");
                        Sysfs.writeString("/sys/class/lego-port/port1/set_device",
                    "lego-nxt-touch");
                        leftSensor = new EV3TouchSensor(SensorPort.S2);
                        rightSensor = new EV3TouchSensor(SensorPort.S1);
                    }
                    /* ... */
                </code></pre>
                <aside class="notes">
                    Sysfs - nochmal versuchen
                </aside>
            </section>
            <section data-auto-animate>
                <h2>Roboter</h2>
                <h3>Kalibrieren</h3>
                <ol>
                    <li>Einen Motor drehen</li>
                    <li>Warten, bis der Sensor gedrückt ist, dann aufhören</li>
                    <li>Das Gleiche für den anderen Motor</li>
                    <li>Einen Motor um 180° versetzen</li>
                </ol>
            </section>
            <section data-auto-animate>
                <h2>Roboter</h2>
                <h3>Kalibrieren</h3>
                <!-- TODO falls sich das kalibrieren noch ändert, hier auch ändern -->
                <pre style="width: 100%"><code data-trim data-line-numbers="2|2,8-10|2,11|2,12|3|4">
                    void calibrate() {
                        calibrateSingleMotor(leftMotor, leftSensor);
                        calibrateSingleMotor(rightMotor, rightSensor);
                        leftMotor.rotate(180);
                    }

                    private void calibrateSingleMotor(RegulatedMotor motor, Touch sensor) {
                        int calibrateSpeed = 270;
                        motor.setSpeed(calibrateSpeed);
                        motor.forward();
                        while (!sensor.isPressed()) Delay.msDelay(5);
                        motor.stop();
                    }
                </code></pre>
                <!--<div class="r-stack">
                    <pre class="fragment fade-out" data-fragment-index="0" style="width: 102%"><code data-trim
                                                                                            data-line-numbers="1|2-4|5-6|14|16|17|18-20|7|8-10"
                                                                                            data-ln-start-from="158">
                        void calibrate(boolean forceCalibrate) {
                            if (forceCalibrate || !isInitiallyCalibrated
                                    || (leftCalibratedAngle != leftMotor.getTachoCount() % 360)
                                    || (rightCalibratedAngle != rightMotor.getTachoCount() % 360)) {
                                calibrateSingleMotor(leftMotor, leftSensor);
                                calibrateSingleMotor(rightMotor, rightSensor);
                                leftMotor.rotate(180);
                                leftCalibratedAngle = leftMotor.getTachoCount() % 360;
                                rightCalibratedAngle = rightMotor.getTachoCount() % 360;
                                isInitiallyCalibrated = true;
                            }
                        }

                        private void calibrateSingleMotor(RegulatedMotor motor, Touch sensor) {
                            int calibrateSpeed = 270;
                            motor.setSpeed(calibrateSpeed);
                            if (sensor.isPressed()) motor.rotate(180);
                            motor.forward();
                            while (!sensor.isPressed()) Delay.msDelay(5);
                            motor.stop();
                        }
                    </code></pre>
                    <pre class="fragment" data-fragment-index="0"><code data-trim data-line-numbers
                                                                                 data-ln-start-from="30">
                        public class Robot {
                            private boolean isInitiallyCalibrated = false;
                            private int leftCalibratedAngle;
                            private int rightCalibratedAngle;
                            /* ... */
                        }
                    </code></pre>
                    <aside class="notes">
                        Variablen - calibrate():<br/><br/>
                        Bedingung - calibrateSingleMotor:<br/><br/>
                        Geschwindigkeit setzen - if pressed rotate 180 - vorwärts, drehen, stoppen<br/><br/>
                        Links 1/2 drehen - Variablen setzen
                    </aside>
                </div>-->
                <aside class="notes">
                    Linker Motor:<br/>
                    Drehen - auf Sensor warten - Stoppen<br/>
                    Rechter Motor - Links 180°
                </aside>
            </section>
        </section>
        <section>
            <section data-auto-animate>
                <h2 class="r-fit-text">Roboter</h2>
                <h3>Funktionen des Roboters</h3>
            </section>
            <section data-auto-animate>
                <h2>Roboter</h2>
                <ul>
                    <li>Vorwärts gehen</li>
                    <li>Rückwärts gehen</li>
                    <li>Drehen</li>
                    <li>Arme bewegen</li>
                </ul>
            </section>
            <section data-auto-animate>

            </section>
            <section data-auto-animate>
                <h2>Roboter</h2>
                <pre style="width: 106%"><code data-trim
                                               data-line-numbers="1|2|3|5-7|9-11|13-15|17-19|21-23|25-27|29-31|33-35|37-39"
                                               data-ln-start-from="8">
                    class Speed {
                        private static final int JAVA_EV3_CONVERSION_FACTOR = 6;
                        private final int javaSpeed;

                        private Speed(int javaSpeed) {
                            this.javaSpeed = javaSpeed;
                        }

                        static Speed javaSpeed(int degreesPerSecond) {
                            return new Speed(degreesPerSecond);
                        }

                        static Speed ev3Speed(int rotationsPerMinute) {
                            return new Speed(rotationsPerMinute * JAVA_EV3_CONVERSION_FACTOR);
                        }

                        int getJavaSpeed() {
                            return javaSpeed;
                        }

                        int getEv3Speed() {
                            return javaSpeed / JAVA_EV3_CONVERSION_FACTOR;
                        }

                        boolean isPositive() {
                            return javaSpeed > 0;
                        }

                        int signum() {
                            return Integer.signum(javaSpeed);
                        }

                        Speed mult(float factor) {
                            return Speed.javaSpeed(Math.round(this.getJavaSpeed() * factor));
                        }

                        Speed negate() {
                            return mult(-1);
                        }
                    }
                </code></pre>
            </section>
            <section data-auto-animate>
                <h2>Roboter</h2>
                <pre><code data-trim data-line-numbers="1|2|4-6|8-10|12-14|16-18|20-22|24-26|28-30|32-34"
                           data-ln-start-from="1">
                    public class RotateAmount {
                        private final int degrees;

                        private RotateAmount(int degrees) {
                            this.degrees = degrees;
                        }

                        public static RotateAmount rotations(float rotations) {
                            return new RotateAmount(Math.round(rotations * 360));
                        }

                        public static RotateAmount degrees(int degrees) {
                            return new RotateAmount(degrees);
                        }

                        public int getDegrees() {
                            return degrees;
                        }

                        public float getRotations() {
                            return (float) degrees / 360F;
                        }

                        boolean isPositive() {
                            return degrees > 0;
                        }

                        int signum() {
                            return Integer.signum(degrees);
                        }

                        RotateAmount mult(int factor) {
                            return RotateAmount.degrees(degrees * factor);
                        }
                    }
                </code></pre>
            </section>
            <section data-auto-animate>
                <h2>Roboter</h2>
                <pre style="width: 120%"><code data-trim
                                               data-line-numbers="1|3-8|10-15|17-20|22-27|29-32|34-38|40-42
                                               |44|45-47|48|49,53-54|50,55|51,56-57
                                               |61-71|73-75|77-79|81-84|86-89|91-93|95-97|99-101|103-105"
                                               data-ln-start-from="30">
                    public class Robot {
                    /* Initialisieren etc. */
                    void forward(Speed s) {
                        leftMotor.setSpeed(s.getJavaSpeed());
                        rightMotor.setSpeed(s.getJavaSpeed());
                        leftMotor.forward();
                        rightMotor.forward();
                    }

                    void backward(Speed s) {
                        leftMotor.setSpeed(s.getJavaSpeed());
                        rightMotor.setSpeed(s.getJavaSpeed());
                        leftMotor.backward();
                        rightMotor.backward();
                    }

                    void stop() {
                        leftMotor.stop(true);
                        rightMotor.stop();
                    }

                    public void rotateSingleMotor(RegulatedMotor motor, Speed speed,
                    RotateAmount amount, boolean immediateReturn) {
                        int degrees = amount.getDegrees() * speed.signum();
                        motor.setSpeed(speed.getJavaSpeed());
                        motor.rotate(degrees, immediateReturn);
                    }

                    public void rotateSingleMotor(RegulatedMotor motor, Speed speed,
                    RotateAmount amount) {
                        rotateSingleMotor(motor, speed, amount, false);
                    }

                    void move(Speed speed, int steps, boolean immediateReturn) {
                        RotateAmount amount = RotateAmount.rotations((float) steps / 2);
                        rotateSingleMotor(leftMotor, speed, amount, true);
                        rotateSingleMotor(rightMotor, speed, amount, immediateReturn);
                    }

                    void move(Speed speed, int steps) {
                        move(speed, steps, false);
                    }

                    void turn(Speed turningSpeed, RotateAmount amount) {
                        int rotationFactor = 45;
                        Speed actualSpeed = turningSpeed.mult(rotationFactor);
                        RotateAmount actualAmount = amount.mult(rotationFactor);
                        if (amount.isPositive()) {
                            rotateSingleMotor(leftMotor, actualSpeed, RotateAmount.degrees(36));
                            rotateSingleMotor(rightMotor, actualSpeed, actualAmount);
                            rotateSingleMotor(leftMotor, actualSpeed, RotateAmount.degrees(-36));
                        } else {
                            rotateSingleMotor(leftMotor, actualSpeed, RotateAmount.degrees(-180));
                            rotateSingleMotor(rightMotor, actualSpeed, RotateAmount.degrees(180 + 36));
                            rotateSingleMotor(leftMotor, actualSpeed, actualAmount);
                            rotateSingleMotor(leftMotor, actualSpeed, RotateAmount.degrees(180));
                            rotateSingleMotor(rightMotor, actualSpeed, RotateAmount.degrees(-180 - 36));
                        }
                    }

                    public RegulatedMotor getRightMotor() {
                        return rightMotor;
                    }

                    public RegulatedMotor getLeftMotor() {
                        return leftMotor;
                    }

                    public RegulatedMotor getArmsMotor() {
                        return armsMotor;
                    }

                    public Buttons getButtons() {
                        return buttons;
                    }

                    public GraphicsLCD getLcd() {
                        return lcd;
                    }

                    void drawImageAndRefresh(Image src, int x, int y, int anchor) {
                        lcd.drawImage(src, x, y, anchor);
                        lcd.refresh();
                    }

                    void say(String message) {
                        espeak.setMessage(message);
                        espeak.say();
                    }

                    void playFile(String path) {
                        Shell.execute("aplay " + path);
                    }

                    CompletableFuture&ltVoid&gt startPlayingFile(String path) {
                        return CompletableFuture.runAsync(() -> playFile(path));
                    }

                    void stopAudio() {
                        Shell.execute("killall aplay");
                    }

                    void beep() {
                        sound.beep();
                    }
                    }
                </code></pre>
            </section>
        </section>
        <section>
            <section>
                    <pre><code data-trim data-noescape>
                    Hallo
                        Hallo                    <!-- Komplizierte Version eines Codes-->
                        Hallo
                        Hallo
        </code></pre>
            </section>
        </section>
        <section>
            <section>
                      <pre><code data-trim data-noescape>
                    for I = your mom      <!-- vereinfachte Version des Codes -->
        </code></pre>
            </section>
        </section>
    </div>
</div>

<script src="dist/reveal.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script>
    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
        hash: true,
        plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ],
        highlight: {
            beforeHighlight: hljs => {
                const codeTags = document.getElementsByTagName("code");
                for (let index = 0; index < codeTags.length; index++) {
                    codeTags[index].classList.add("language-java");
                }
            }
        }
    });
</script>
</body>
</html>
